---
// src/components/Image.astro
import type { ImageMetadata } from "astro";
import { Image as AstroImage } from "astro:assets";

interface Props {
    src: string | ImageMetadata;
    alt: string;
    caption?: string;
    width?: number;
    height?: number;
    class?: string;
}

const { src, alt, caption, width, height, class: className } = Astro.props;

const isRemoteOrPublic = typeof src === "string";
const hasDimensions = width && height;
---

<figure class:list={["image-wrapper", className]}>
    {
        isRemoteOrPublic && !hasDimensions ? (
            <img
                src={src as string}
                alt={alt}
                class="rounded-shadow"
                loading="lazy"
                decoding="async"
            />
        ) : (
            <AstroImage
                src={src}
                alt={alt}
                width={width || 800}
                height={height || undefined}
                class="rounded-shadow"
            />
        )
    }

    {caption && <figcaption>{caption}</figcaption>}
</figure>

<style>
    .image-wrapper {
        margin: 3rem auto;
        max-width: 100%;
        width: fit-content;
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .rounded-shadow {
        display: block;
        max-width: 100%;
        height: auto;
        border-radius: 12px;
        border: 1px solid var(--card-border-color);
        background-color: var(--card-bg-color);
        box-shadow: 0 8px 20px var(--shadow-hover-color);
    }

    figcaption {
        margin-top: 0.75rem;
        padding: 0 0.5rem;
        text-align: center;
        font-size: 0.9rem;
        color: var(--font-color-light);
        font-style: italic;
    }
</style>

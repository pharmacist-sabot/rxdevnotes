---
// src/components/ViewCounter.astro
type Props = {
  slug: string;
};

const { slug } = Astro.props;
---

<span class="view-counter">
  <span id="view-count-value">...</span> views
</span>

<script define:vars={{ slug }}>
  const viewCountElement = document.getElementById('view-count-value');

  async function updateViewCount() {
    try {
      const res = await fetch(`/api/views/${slug}`, {
        method: 'POST',
      });
      const data = await res.json();

      if (viewCountElement) {
        viewCountElement.textContent = data.count;
      }
    }
    catch (e) {
      console.error('Error fetching view count:', e);
      if (viewCountElement) {
        viewCountElement.textContent = '0';
      }
    }
  }

  updateViewCount();
</script>

<style>
  .view-counter {
    font-family: var(--font-mono);
    font-size: 0.9em;
    opacity: 0.8;
  }
</style>
